---
layout: post
title: phpの@(アットマーク)はオーバーヘッドが大きいから使わないほうがよい
published: true
---
<p>事の発端はこれ。</p>
<div class="CodeRay">
  <div class="code"><pre>// 1. 
if (isset($checkedAry['key']) &amp;&amp; $checkedAry['key'] == &quot;val&quot;) {
    // 処理
}

// 2. 1より早いんじゃね？
if ($checkedAry['key'] == &quot;val&quot;) {
    // でもNoticeでちゃうよ！
    // PHP Notice:  Undefined index: index
}

// 3. 2の「PHP Notice」の回避策　＠
if (@$checkedAry['key'] == &quot;val&quot;) {
    // 処理
}</pre></div>
</div>

<p>１と３なら３のほうが処理早いんじゃね？ってことで試してみたところ、こうなった。 （PHP 5.3.3）</p>
<div class="CodeRay">
  <div class="code"><pre>&lt;?php
$ary = array(
    array( &quot;key1&quot; =&gt; &quot;val1&quot;, &quot;key2&quot; =&gt; &quot;val2&quot;,&quot;key3&quot; =&gt; &quot;val3&quot;,&quot;key4&quot; =&gt; &quot;val4&quot;),
    array( &quot;key1&quot; =&gt; &quot;val1&quot;, &quot;key2&quot; =&gt; &quot;val2&quot;,&quot;key3&quot; =&gt; &quot;val3&quot;),
);

$time_start = microtime(true);

$index = 0;
foreach (range(1,100000) as $count) {
    $index = 1 - $index;
    $checkedAry = $ary[$index];
    if (isset($checkedAry['key4']) &amp;&amp; $checkedAry['key4'] == &quot;val4&quot;) {
        pow($count, $count);
    }
}

$time = microtime(true) - $time_start;
echo &quot;$time second&quot;;


$time_start = microtime(true);

$index = 0;
foreach (range(1,100000) as $count) {
    $index = 1 - $index;
    $checkedAry = $ary[$index];
    if (@$checkedAry['key4'] == &quot;val4&quot;) {
        pow($count, $count);
    }
}

$time = microtime(true) - $time_start;
echo &quot;$time second&quot;;</pre></div>
</div>

<p>３回やってみてこんな結果でした。</p>
<div class="CodeRay">
  <div class="code"><pre>0.098845958709717 second
0.19816088676453 second

0.097808122634888 second
0.15862894058228 second

0.10174417495728 second
0.16551208496094 second</pre></div>
</div>

<p>つまり、<strong>＠付きのほうがそうじゃないほうより１．５倍～２倍程度遅い</strong>、ということになります。</p>
<p>ただ、<strong>＠付きのほうがシンプルに書ける場合もある</strong>ので、今回の例のようにループさせている場合でないのであれば、＠付きを使ってもよいのかもしれません。</p>
<h3>参考</h3>
<p><a href="http://www.l2tp.org/?p=1523">アットマークでエラーを抑制したときのオーバーヘッドについて検証してみた with php5.3三項演算子</a></p>
